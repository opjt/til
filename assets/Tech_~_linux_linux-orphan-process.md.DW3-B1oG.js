import{_ as i,c as a,o as h,ag as n}from"./chunks/framework.B0zzL8Pn.js";const C=JSON.parse('{"title":"Linux Orphan Process","description":"","frontmatter":{},"headers":[],"relativePath":"Tech/~/linux/linux-orphan-process.md","filePath":"Tech/~/linux/linux-orphan-process.md","lastUpdated":1765801377000}'),p={name:"Tech/~/linux/linux-orphan-process.md"};function l(t,s,k,e,F,d){return h(),a("div",null,s[0]||(s[0]=[n(`<h1 id="linux-orphan-process" tabindex="-1">Linux Orphan Process <a class="header-anchor" href="#linux-orphan-process" aria-label="Permalink to &quot;Linux Orphan Process&quot;">​</a></h1><p><code>orphan</code>: 고아, 부모를 잃거나 부모가 없어진 아이.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $$</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">824904</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 824904</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TTY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          TIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      824904</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  824898</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:32</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    00:00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span></span></code></pre></div><p><code>ps</code> 명령어로 조회해보면 모든 프로세스에는 부모프로세스가 존재한다.</p><p>ssh로 접근하게 된다면</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $$</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">824904</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 824904</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TTY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          TIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      824904</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  824898</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:32</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    00:00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 824898</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TTY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          TIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      824898</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     939</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:32</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root@pts/0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 939</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TTY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          TIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         939</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jul22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        00:16:52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/sbin/sshd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [listener] 0 of 10-100 startups</span></span></code></pre></div><p>이처럼 부모를 타고타고 올라가면 결국 부모 프로세스가 <code>1</code>이 나온다.</p><p>만약 ssh로 접속 후 프로세스를 실행한다음 ssh 세션을 종료하면, 실행한 프로세스의 부모프로세스는 어떻게 될까?</p><ul><li>실행된 프로세스가 종료되지 않고 살아 있다면, 해당 프로세스는 고아 프로세스가 되며, PPID는 <code>1</code>로 변경된다.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@pve:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pid,ppid,tty,cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 828084</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 828084</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ./main</span></span></code></pre></div><h2 id="bash-c-exec-main" tabindex="-1">bash -c &quot;exec ./main &amp;&quot; <a class="header-anchor" href="#bash-c-exec-main" aria-label="Permalink to &quot;bash -c &quot;exec ./main &amp;&quot;&quot;">​</a></h2><p><code>bash -c &quot;exec ./main &amp;&quot;</code> 명령어를 실행하고 나면 main 프로세스의 ppid 는 무엇이 될까?</p><h3 id="bash-c의-의미" tabindex="-1"><code>bash -c</code>의 의미 <a class="header-anchor" href="#bash-c의-의미" aria-label="Permalink to &quot;\`bash -c\`의 의미&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...&quot;</span></span></code></pre></div><ul><li>새로운 비대화형 bash 프로세스를 실행.</li><li>문자열 안의 명령을 실행한 뒤 즉시 종료</li></ul><p>즉, 기존 SSH 세션의 bash가 아닌 하위 bash 프로세스가 잠깐 실행되었다가 종료되는 구조이다</p><h3 id="exec-커맨드" tabindex="-1"><code>exec</code> 커맨드 <a class="header-anchor" href="#exec-커맨드" aria-label="Permalink to &quot;\`exec\` 커맨드&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./main</span></span></code></pre></div><ul><li>새로운 프로세스를 생성하지 않는다.</li><li>현재 bash 프로세스를 <code>./main</code>으로 치환(replace) 한다.(PID 유지)</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">login-bash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PID </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└─</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pid </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> →</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pid </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>이런 구조가 됨.</p><h3 id="가-붙었을-때-흐름" tabindex="-1"><code>&amp;</code> 가 붙었을 때 흐름 <a class="header-anchor" href="#가-붙었을-때-흐름" aria-label="Permalink to &quot;\`&amp;\` 가 붙었을 때 흐름&quot;">​</a></h3><p>exec 커맨드의 &amp;가 붙으면?</p><p>PID B(<code>./main</code>)가 백그라운드에서 돌아가며, 다음 작업을 할 수 있도록 프롬포트를 반환하게 됨.</p><ul><li>PID A(로그인 쉘)는 자신이 시작한 명령(<code>bash -c &quot;...</code>)이 성공적으로 완료되었다고 판단함</li><li>이시점에서 PID B는 부모(PID A)가 자신을 관리하지 않고 떠난 상태, 즉 고아 프로세스가 됨. <ul><li>명령 실행을 완료하였으니 PID B에 대한 관리 책임이 없기 때문.</li></ul></li></ul><h3 id="결론" tabindex="-1">결론 <a class="header-anchor" href="#결론" aria-label="Permalink to &quot;결론&quot;">​</a></h3><p><code>bash -c &quot;exec ./main &amp;&quot;</code> 으로 실행하게 되면 main의 PPID는 1이 된다.</p>`,27)]))}const o=i(p,[["render",l]]);export{C as __pageData,o as default};
